<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ULTRA SHOP PRO</title>
<style>
:root{--main:#ff4757;--dark:#2f3542;--light:#f1f2f6;--gold:#ffd700;--gray:#888}
body{font-family:'Segoe UI',sans-serif;background:var(--light);margin:0;padding-bottom:50px;overflow-x:hidden}

/* –®–∞–ø–∫–∞ —Ç–∞ –ö–æ–Ω—Ç—Ä–æ–ª—ñ */
header{background:#fff;padding:15px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}
.plus-btn{position:absolute;right:20px;top:15px;font-size:24px;cursor:pointer;color:var(--main);font-weight:bold}
.controls{padding:10px;display:flex;flex-direction:column;gap:8px}
input,textarea,button{padding:12px;border-radius:10px;border:1px solid #ddd;outline:none;font-size:14px}

/* –ö–∞—Ç–∞–ª–æ–≥ */
.catalog{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:10px}
.card{background:#fff;border-radius:12px;padding:8px;box-shadow:0 2px 4px rgba(0,0,0,.05);border:4px solid transparent;position:relative}
.card img{width:100%;height:130px;object-fit:cover;border-radius:8px}
.price{color:var(--main);font-weight:bold;font-size:16px;margin:5px 0}
.card-id{font-size:10px;color:#aaa}

/* –†–∞–º–∫–∏ */
.r-black{border-color:#000} .r-gray{border-color:var(--gray)} .r-blue{border-color:#3498db}
.r-yellow{border-color:#f1c40f} .r-red{border-color:#e74c3c} .r-green{border-color:#2ecc71}
.r-purple{border-color:#9b59b6} .r-gold{border-color:var(--gold);box-shadow:0 0 10px var(--gold)}

/* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (–§—ñ–∫—Å —Ä–æ–∑–º—ñ—Ä—É) */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;justify-content:center;align-items:center}
.modal.show{display:flex}
.m-cont{background:#fff;width:95%;max-width:400px;border-radius:20px;display:flex;flex-direction:column;position:relative;max-height:90vh;overflow:hidden}
.m-body{padding:20px;overflow-y:auto;flex-grow:1}

/* –°–ª–∞–π–¥–µ—Ä */
.slider-container{width:100%;height:250px;position:relative;background:#eee;flex-shrink:0}
.slider{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;height:100%;scrollbar-width:none}
.slider::-webkit-scrollbar{display:none}
.slider img{width:100%;height:100%;object-fit:cover;scroll-snap-align:start;flex-shrink:0}
.close-x{position:absolute;top:10px;right:15px;font-size:35px;cursor:pointer;color:#fff;text-shadow:0 0 5px #000;z-index:11}

.order-footer{background:var(--main);color:#fff;padding:15px;border-radius:12px;text-align:center;margin-top:15px}
.order-footer a{color:#fff;text-decoration:none;font-weight:bold;font-size:18px;display:block}
</style>
</head>
<body>

<header>
  <h2 style="margin:0">ULTRA SHOP</h2>
  <div class="plus-btn" onclick="openAdmin()">+</div>
</header>

<div class="controls">
  <input type="text" id="srch" placeholder="–ü–æ—à—É–∫...">
  <div style="display:flex;gap:5px;overflow-x:auto" id="fltr">
    <button onclick="filterP(0,999999)" style="background:var(--main);color:#fff;border:none;border-radius:20px;padding:5px 15px">–í—Å—ñ</button>
  </div>
</div>

<div class="catalog" id="cat"></div>

<div id="mView" class="modal">
  <div class="m-cont">
    <div class="close-x" onclick="closeM()">√ó</div>
    <div class="slider-container" id="vWrap">
        <div class="slider" id="vSlider"></div>
    </div>
    <div class="m-body">
        <h2 id="vt" style="margin:0"></h2>
        <div id="vp" style="color:var(--main);font-size:22px;font-weight:bold;margin:5px 0"></div>
        <div id="vid" style="font-size:11px;color:#aaa;margin-bottom:10px"></div>
        <div id="vd" style="line-height:1.5;color:#444"></div>
        
        <div class="order-footer">
            <div>–ó–∞–º–æ–≤–ª—è–π —Ç—É—Ç üëá</div>
            <a href="tel:+380XXXXXXXXX">+380XXXXXXXXX</a>
        </div>
        <button id="delB" style="width:100%;margin-top:15px;color:red;border:1px solid red;background:none;border-radius:8px;padding:5px;display:none">–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä</button>
    </div>
  </div>
</div>

<div id="mAdmin" class="modal">
  <div class="m-cont" style="padding:20px; gap:10px">
    <div id="boxLogin">
        <h3>–ê–¥–º—ñ–Ω-–≤—Ö—ñ–¥</h3>
        <input type="password" id="code" placeholder="–ö–æ–¥" style="width:100%;margin-bottom:10px">
        <button onclick="login()" style="width:100%;background:#2ecc71;color:#fff;border:none">–£–≤—ñ–π—Ç–∏</button>
    </div>
    <div id="boxAdd" style="display:none; flex-direction:column; gap:8px">
        <h3>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
        <input type="text" id="t" placeholder="–ù–∞–∑–≤–∞">
        <input type="number" id="p" placeholder="–¶—ñ–Ω–∞">
        <textarea id="d" placeholder="–û–ø–∏—Å (–º–æ–∂–Ω–∞ –¥–æ–≤–≥–∏–π)"></textarea>
        <p style="font-size:11px;margin:0">–í–∏–±–µ—Ä—ñ—Ç—å –æ—Å–Ω–æ–≤–Ω–µ —Ñ–æ—Ç–æ:</p>
        <input type="file" id="f" accept="image/*">
        <button id="btnS" style="background:#2ecc71;color:#fff;border:none" onclick="save()">üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
    </div>
    <button onclick="closeM()" style="margin-top:10px">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

const conf = {
  apiKey: "AIzaSyD3BQTZeCp74owFliqECbUgufJ3UC6dFC8",
  authDomain: "vip-shop-a2ec4.firebaseapp.com",
  projectId: "vip-shop-a2ec4",
  databaseURL: "https://vip-shop-a2ec4-default-rtdb.firebaseio.com",
  appId: "1:429877342673:web:bf2fbcddd5f3ba04c670f0"
};

const app = initializeApp(conf);
const db = getDatabase(app);
let isAdmin = false, all = [];

window.closeM = () => { document.querySelectorAll('.modal').forEach(m=>m.classList.remove('show')); };
window.openAdmin = () => { document.getElementById('mAdmin').classList.add('show'); };

window.login = () => {
  if(document.getElementById('code').value === 'xxxshop') {
    isAdmin = true;
    document.getElementById('boxLogin').style.display='none';
    document.getElementById('boxAdd').style.display='flex';
  } else alert('–ù–µ–≤—ñ—Ä–Ω–æ!');
};

const getR = (p) => {
    if(p >= 2001) return 'r-gold'; if(p >= 1500) return 'r-purple';
    if(p >= 1000) return 'r-green'; if(p >= 700) return 'r-red';
    if(p >= 400) return 'r-yellow'; if(p >= 200) return 'r-blue';
    if(p >= 100) return 'r-gray'; return 'r-black';
};

const render = (items) => {
  const cat = document.getElementById('cat');
  cat.innerHTML = '';
  items.forEach(i => {
    const div = document.createElement('div');
    div.className = `card ${getR(i.price)}`;
    div.innerHTML = `<img src="${i.img}"><div class="price">${i.price} –≥—Ä–Ω</div>
                     <div style="font-size:13px;font-weight:bold">${i.title}</div>
                     <div class="card-id">ID: ${i.id.substring(1,7)}</div>`;
    div.onclick = () => {
      const slider = document.getElementById('vSlider');
      slider.innerHTML = `<img src="${i.img}">`; // –ü–æ–∫–∏ —â–æ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∑ –±–∞–∑–∏
      document.getElementById('vt').innerText = i.title;
      document.getElementById('vp').innerText = i.price + ' –≥—Ä–Ω';
      document.getElementById('vd').innerText = i.desc || '';
      document.getElementById('vid').innerText = '–ê–†–¢–ò–ö–£–õ: ' + i.id.toUpperCase();
      document.getElementById('vWrap').style.borderColor = getR(i.price) === 'r-gold' ? 'gold' : '#eee';
      
      const dbnt = document.getElementById('delB');
      dbnt.style.display = isAdmin ? 'block' : 'none';
      dbnt.onclick = () => {
          if(prompt('–ö–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:') === 'xxxshop') {
              remove(ref(db, 'products/'+i.id)); closeM();
          } else alert('–ü–æ–º–∏–ª–∫–∞!');
      };
      document.getElementById('mView').classList.add('show');
    };
    cat.appendChild(div);
  });
};

onValue(ref(db, 'products'), s => {
  const d = s.val();
  all = d ? Object.keys(d).map(id => ({ id, ...d[id] })) : [];
  render(all);
});

window.save = async () => {
  const title = document.getElementById('t').value, price = +document.getElementById('p').value;
  const desc = document.getElementById('d').value, file = document.getElementById('f').files[0];
  if(!title || price < 5 || !file) return alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è!');
  
  document.getElementById('btnS').innerText = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
  const fd = new FormData(); fd.append('image', file);
  const r = await fetch('https://api.imgbb.com/1/upload?key=03c26bf2c4e95bbd1e544d9d2cad9672', {method:'POST', body:fd});
  const res = await r.json();
  set(push(ref(db, 'products')), { title, price, desc, img: res.data.url });
  closeM();
  document.getElementById('btnS').innerText = 'üöÄ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏';
};

window.filterP = (min, max) => render(all.filter(i => i.price >= min && i.price <= max));

document.getElementById('srch').oninput = e => {
  const q = e.target.value.toLowerCase();
  render(all.filter(i => i.title.toLowerCase().includes(q) || i.id.toLowerCase().includes(q)));
};
</script>
</body>
</html>
